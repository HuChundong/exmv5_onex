From 937f1a535fcfb1b798c34e713b102195d2a67bf1 Mon Sep 17 00:00:00 2001
From: Kingme <gycm520@gmail.com>
Date: Wed, 7 Aug 2013 07:46:09 +0800
Subject: [PATCH] 3way reboot menu

Change-Id: I8458e683cec64f89c05808536eb5069739aa78fb
Signed-off-by: Kingme <gycm520@gmail.com>
---
 .../policy/impl/MiuiGlobalActions$222$1.smali      |   87 +++++++++++++
 .../policy/impl/MiuiGlobalActions$222$2.smali      |   43 +++++++
 .../policy/impl/MiuiGlobalActions$222.smali        |  134 ++++++++++++++++++++
 .../impl/MiuiGlobalActions$SinglePressAction.smali |   36 ++++++
 .../internal/policy/impl/MiuiGlobalActions.smali   |    4 +-
 5 files changed, 302 insertions(+), 2 deletions(-)
 create mode 100644 android.policy/smali/com/android/internal/policy/impl/MiuiGlobalActions$222$1.smali
 create mode 100644 android.policy/smali/com/android/internal/policy/impl/MiuiGlobalActions$222$2.smali
 create mode 100644 android.policy/smali/com/android/internal/policy/impl/MiuiGlobalActions$222.smali


--- /dev/null
+++ b/android.policy/smali/com/android/internal/policy/impl/MiuiGlobalActions$222$1.smali
@@ -0,0 +1,87 @@
+.class Lcom/android/internal/policy/impl/MiuiGlobalActions$222$1;
+.super Ljava/lang/Object;
+.source "MiuiGlobalActions.java"
+
+# interfaces
+.implements Landroid/content/DialogInterface$OnClickListener;
+
+
+# annotations
+.annotation system Ldalvik/annotation/EnclosingMethod;
+    value = Lcom/android/internal/policy/impl/MiuiGlobalActions$222;->onPress()V
+.end annotation
+
+.annotation system Ldalvik/annotation/InnerClass;
+    accessFlags = 0x0
+    name = null
+.end annotation
+
+
+# instance fields
+.field final synthetic this$1:Lcom/android/internal/policy/impl/MiuiGlobalActions$222;
+
+
+# direct methods
+.method constructor <init>(Lcom/android/internal/policy/impl/MiuiGlobalActions$222;)V
+    .locals 0
+
+    .prologue
+    iput-object p1, p0, Lcom/android/internal/policy/impl/MiuiGlobalActions$222$1;->this$1:Lcom/android/internal/policy/impl/MiuiGlobalActions$222;
+
+    invoke-direct {p0}, Ljava/lang/Object;-><init>()V
+
+    return-void
+.end method
+
+
+# virtual methods
+.method public onClick(Landroid/content/DialogInterface;I)V
+    .locals 4
+    .parameter "dialog"
+    .parameter "whichButton"
+
+    .prologue
+    const/4 v2, 0x0
+
+    sget v0, Lcom/android/internal/policy/impl/MiuiGlobalActions$SinglePressAction;->rebootMode:I
+
+    const/4 v1, -0x1
+
+    if-le v0, v1, :cond_0
+
+    sget v0, Lcom/android/internal/policy/impl/MiuiGlobalActions$SinglePressAction;->rebootMode:I
+
+    iget-object v0, p0, Lcom/android/internal/policy/impl/MiuiGlobalActions$222$1;->this$1:Lcom/android/internal/policy/impl/MiuiGlobalActions$222;
+
+    iget-object v0, v0, Lcom/android/internal/policy/impl/MiuiGlobalActions$222;->this$0:Lcom/android/internal/policy/impl/MiuiGlobalActions;
+
+    #getter for: Lcom/android/internal/policy/impl/MiuiGlobalActions;->mContext:Landroid/content/Context;
+    invoke-static {v0}, Lcom/android/internal/policy/impl/MiuiGlobalActions;->access$300(Lcom/android/internal/policy/impl/MiuiGlobalActions;)Landroid/content/Context;
+
+    move-result-object v0
+
+    sget v1, Lcom/android/internal/policy/impl/MiuiGlobalActions$SinglePressAction;->rebootMode:I
+
+    if-nez v1, :cond_1
+
+    const/4 v1, 0x0
+
+    :goto_0
+    invoke-static {v0, v1, v2}, Lcom/android/server/pm/ShutdownThread;->reboot(Landroid/content/Context;Ljava/lang/String;Z)V
+
+    :cond_0
+    return-void
+
+    :cond_1
+    sget-object v1, Lcom/android/internal/policy/impl/MiuiGlobalActions$SinglePressAction;->rebootOptions:[Ljava/lang/String;
+
+    sget v3, Lcom/android/internal/policy/impl/MiuiGlobalActions$SinglePressAction;->rebootMode:I
+
+    aget-object v1, v1, v3
+
+    invoke-virtual {v1}, Ljava/lang/String;->toLowerCase()Ljava/lang/String;
+
+    move-result-object v1
+
+    goto :goto_0
+.end method


--- /dev/null
+++ b/android.policy/smali/com/android/internal/policy/impl/MiuiGlobalActions$222$2.smali
@@ -0,0 +1,43 @@
+.class Lcom/android/internal/policy/impl/MiuiGlobalActions$222$2;
+.super Ljava/lang/Object;
+.source "MiuiGlobalActions.java"
+
+# interfaces
+.implements Landroid/content/DialogInterface$OnClickListener;
+
+
+# annotations
+.annotation system Ldalvik/annotation/EnclosingMethod;
+    value = Lcom/android/internal/policy/impl/MiuiGlobalActions$222;->onPress()V
+.end annotation
+
+.annotation system Ldalvik/annotation/InnerClass;
+    accessFlags = 0x0
+    name = null
+.end annotation
+
+
+# instance fields
+.field final synthetic this$1:Lcom/android/internal/policy/impl/MiuiGlobalActions$222;
+
+
+# direct methods
+.method constructor <init>(Lcom/android/internal/policy/impl/MiuiGlobalActions$222;)V
+    .locals 0
+
+    iput-object p1, p0, Lcom/android/internal/policy/impl/MiuiGlobalActions$222$2;->this$1:Lcom/android/internal/policy/impl/MiuiGlobalActions$222;
+
+    invoke-direct {p0}, Ljava/lang/Object;-><init>()V
+
+    return-void
+.end method
+
+
+# virtual methods
+.method public onClick(Landroid/content/DialogInterface;I)V
+    .locals 0
+
+    sput p2, Lcom/android/internal/policy/impl/MiuiGlobalActions$SinglePressAction;->rebootMode:I
+
+    return-void
+.end method


--- /dev/null
+++ b/android.policy/smali/com/android/internal/policy/impl/MiuiGlobalActions$222.smali
@@ -0,0 +1,134 @@
+.class Lcom/android/internal/policy/impl/MiuiGlobalActions$222;
+.super Lcom/android/internal/policy/impl/MiuiGlobalActions$SinglePressAction;
+.source "MiuiGlobalActions.java"
+
+
+# annotations
+.annotation system Ldalvik/annotation/EnclosingMethod;
+    value = Lcom/android/internal/policy/impl/MiuiGlobalActions;->createDialog()Landroid/app/AlertDialog;
+.end annotation
+
+.annotation system Ldalvik/annotation/InnerClass;
+    accessFlags = 0x0
+    name = null
+.end annotation
+
+
+# instance fields
+.field final synthetic this$0:Lcom/android/internal/policy/impl/MiuiGlobalActions;
+
+
+# direct methods
+.method constructor <init>(Lcom/android/internal/policy/impl/MiuiGlobalActions;II)V
+    .locals 0
+
+    iput-object p1, p0, Lcom/android/internal/policy/impl/MiuiGlobalActions$222;->this$0:Lcom/android/internal/policy/impl/MiuiGlobalActions;
+
+    invoke-direct {p0, p2, p3}, Lcom/android/internal/policy/impl/MiuiGlobalActions$SinglePressAction;-><init>(II)V
+
+    return-void
+.end method
+
+
+# virtual methods
+.method public onPress()V
+    .locals 6
+
+    const/4 v5, 0x2
+
+    new-instance v1, Landroid/app/AlertDialog$Builder;
+
+    iget-object v2, p0, Lcom/android/internal/policy/impl/MiuiGlobalActions$222;->this$0:Lcom/android/internal/policy/impl/MiuiGlobalActions;
+
+    #getter for: Lcom/android/internal/policy/impl/MiuiGlobalActions;->mContext:Landroid/content/Context;
+    invoke-static {v2}, Lcom/android/internal/policy/impl/MiuiGlobalActions;->access$300(Lcom/android/internal/policy/impl/MiuiGlobalActions;)Landroid/content/Context;
+
+    move-result-object v2
+
+    invoke-direct {v1, v2}, Landroid/app/AlertDialog$Builder;-><init>(Landroid/content/Context;)V
+
+    const-string v2, "\u91cd\u542f\u624b\u673a"
+
+    invoke-virtual {v1, v2}, Landroid/app/AlertDialog$Builder;->setTitle(Ljava/lang/CharSequence;)Landroid/app/AlertDialog$Builder;
+
+    move-result-object v1
+
+    sget-object v2, Lcom/android/internal/policy/impl/MiuiGlobalActions$SinglePressAction;->rebootOptions:[Ljava/lang/String;
+
+    const/4 v3, 0x0
+
+    new-instance v4, Lcom/android/internal/policy/impl/MiuiGlobalActions$222$2;
+
+    invoke-direct {v4, p0}, Lcom/android/internal/policy/impl/MiuiGlobalActions$222$2;-><init>(Lcom/android/internal/policy/impl/MiuiGlobalActions$222;)V
+
+    invoke-virtual {v1, v2, v3, v4}, Landroid/app/AlertDialog$Builder;->setSingleChoiceItems([Ljava/lang/CharSequence;ILandroid/content/DialogInterface$OnClickListener;)Landroid/app/AlertDialog$Builder;
+
+    move-result-object v1
+
+    const-string v2, "\u786e\u5b9a"
+
+    new-instance v3, Lcom/android/internal/policy/impl/MiuiGlobalActions$222$1;
+
+    invoke-direct {v3, p0}, Lcom/android/internal/policy/impl/MiuiGlobalActions$222$1;-><init>(Lcom/android/internal/policy/impl/MiuiGlobalActions$222;)V
+
+    invoke-virtual {v1, v2, v3}, Landroid/app/AlertDialog$Builder;->setPositiveButton(Ljava/lang/CharSequence;Landroid/content/DialogInterface$OnClickListener;)Landroid/app/AlertDialog$Builder;
+
+    move-result-object v1
+
+    const-string v2, "\u53d6\u6d88"
+
+    const/4 v3, 0x0
+
+    invoke-virtual {v1, v2, v3}, Landroid/app/AlertDialog$Builder;->setNegativeButton(Ljava/lang/CharSequence;Landroid/content/DialogInterface$OnClickListener;)Landroid/app/AlertDialog$Builder;
+
+    move-result-object v1
+
+    invoke-virtual {v1}, Landroid/app/AlertDialog$Builder;->create()Landroid/app/AlertDialog;
+
+    move-result-object v0
+
+    invoke-virtual {v0}, Landroid/app/AlertDialog;->getWindow()Landroid/view/Window;
+
+    move-result-object v1
+
+    const/16 v2, 0x7d9
+
+    invoke-virtual {v1, v2}, Landroid/view/Window;->setType(I)V
+
+    iget-object v1, p0, Lcom/android/internal/policy/impl/MiuiGlobalActions$222;->this$0:Lcom/android/internal/policy/impl/MiuiGlobalActions;
+
+    #getter for: Lcom/android/internal/policy/impl/MiuiGlobalActions;->mContext:Landroid/content/Context;
+    invoke-static {v1}, Lcom/android/internal/policy/impl/MiuiGlobalActions;->access$300(Lcom/android/internal/policy/impl/MiuiGlobalActions;)Landroid/content/Context;
+
+    move-result-object v1
+
+    invoke-virtual {v1}, Landroid/content/Context;->getResources()Landroid/content/res/Resources;
+
+    move-result-object v1
+
+    invoke-virtual {v0}, Landroid/app/AlertDialog;->getWindow()Landroid/view/Window;
+
+    move-result-object v1
+
+    invoke-virtual {v1, v5, v5}, Landroid/view/Window;->setFlags(II)V
+
+    invoke-virtual {v0}, Landroid/app/AlertDialog;->show()V
+
+    return-void
+.end method
+
+.method public showBeforeProvisioning()Z
+    .locals 1
+
+    const/4 v0, 0x1
+
+    return v0
+.end method
+
+.method public showDuringKeyguard()Z
+    .locals 1
+
+    const/4 v0, 0x1
+
+    return v0
+.end method


--- a/android.policy/smali/com/android/internal/policy/impl/MiuiGlobalActions$SinglePressAction.smali
+++ b/android.policy/smali/com/android/internal/policy/impl/MiuiGlobalActions$SinglePressAction.smali
@@ -17,6 +17,12 @@
 .end annotation
 
 
+# static fields
+.field protected static rebootMode:I
+
+.field protected static final rebootOptions:[Ljava/lang/String;
+
+
 # instance fields
 .field private mIconResId:I
 
@@ -28,6 +34,36 @@
 
 
 # direct methods
+.method static constructor <clinit>()V
+    .locals 3
+
+    const/4 v0, 0x3
+
+    new-array v0, v0, [Ljava/lang/String;
+
+    const/4 v1, 0x0
+
+    const-string v2, "Normal"
+
+    aput-object v2, v0, v1
+
+    const/4 v1, 0x1
+
+    const-string v2, "Recovery"
+
+    aput-object v2, v0, v1
+
+    const/4 v1, 0x2
+
+    const-string v2, "Bootloader"
+
+    aput-object v2, v0, v1
+
+    sput-object v0, Lcom/android/internal/policy/impl/MiuiGlobalActions$SinglePressAction;->rebootOptions:[Ljava/lang/String;
+
+    return-void
+.end method
+
 .method protected constructor <init>(II)V
     .locals 0
     .parameter "iconResId"

	 
--- a/android.policy/smali/com/android/internal/policy/impl/MiuiGlobalActions.smali
+++ b/android.policy/smali/com/android/internal/policy/impl/MiuiGlobalActions.smali
@@ -453,13 +453,13 @@
 
     iget-object v0, p0, Lcom/android/internal/policy/impl/MiuiGlobalActions;->mItems:Ljava/util/ArrayList;
 
-    new-instance v1, Lcom/android/internal/policy/impl/MiuiGlobalActions$4;
+    new-instance v1, Lcom/android/internal/policy/impl/MiuiGlobalActions$222;
 
     const v2, 0x6020074
 
     const v3, 0x60c000d
 
-    invoke-direct {v1, p0, v2, v3}, Lcom/android/internal/policy/impl/MiuiGlobalActions$4;-><init>(Lcom/android/internal/policy/impl/MiuiGlobalActions;II)V
+    invoke-direct {v1, p0, v2, v3}, Lcom/android/internal/policy/impl/MiuiGlobalActions$222;-><init>(Lcom/android/internal/policy/impl/MiuiGlobalActions;II)V
 
     invoke-virtual {v0, v1}, Ljava/util/ArrayList;->add(Ljava/lang/Object;)Z
 
-- 
1.7.10.4

